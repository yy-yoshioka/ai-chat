{"file":"/Users/yusukeyoshioka/projects/youtube/ai-chat/ai-chat-api/src/routes/widgets.ts","mappings":"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","names":[],"sources":["/Users/yusukeyoshioka/projects/youtube/ai-chat/ai-chat-api/src/routes/widgets.ts"],"sourcesContent":["import express from 'express';\nimport { authMiddleware as requireAuth } from '../middleware/auth';\nimport { orgAccessMiddleware as requireOrgAccess } from '../middleware/organizationAccess';\nimport { requirePermission, logDataAccess } from '../middleware/security';\nimport { Permission } from '@prisma/client';\nimport * as widgetService from '../services/widgetService';\n\nconst router = express.Router();\n\n// Get widgets by organization\nrouter.get(\n  '/',\n  requireAuth,\n  requireOrgAccess,\n  requirePermission(Permission.WIDGET_READ),\n  logDataAccess('widgets', 'SELECT'),\n  async (req, res) => {\n    try {\n      const { page, limit, search, status } = req.query;\n\n      const result = await widgetService.getWidgetsByOrganization(\n        req.organizationId!,\n        {\n          page: page ? parseInt(page as string) : undefined,\n          limit: limit ? parseInt(limit as string) : undefined,\n          search: search as string,\n          status: status as 'active' | 'inactive' | 'all',\n        }\n      );\n\n      res.json(result);\n    } catch (error) {\n      res.status(500).json({ error: 'Failed to fetch widgets' });\n    }\n  }\n);\n\n// Create widget\nrouter.post(\n  '/',\n  requireAuth,\n  requireOrgAccess,\n  requirePermission(Permission.WIDGET_WRITE),\n  logDataAccess('widgets', 'INSERT'),\n  async (req, res) => {\n    try {\n      const widget = await widgetService.createWidget({\n        ...req.body,\n        organizationId: req.organizationId!,\n      });\n      res.status(201).json(widget);\n    } catch (error) {\n      const message =\n        error instanceof Error ? error.message : 'Failed to create widget';\n      const status =\n        message.includes('not found') || message.includes('access denied')\n          ? 400\n          : 500;\n      res.status(status).json({ error: message });\n    }\n  }\n);\n\n// Get widget by ID\nrouter.get(\n  '/:id',\n  requireAuth,\n  requireOrgAccess,\n  requirePermission(Permission.WIDGET_READ),\n  logDataAccess('widgets', 'SELECT'),\n  async (req, res) => {\n    try {\n      const widget = await widgetService.getWidgetById(\n        req.params.id,\n        req.organizationId!\n      );\n      res.json(widget);\n    } catch (error) {\n      const message =\n        error instanceof Error ? error.message : 'Failed to fetch widget';\n      const status =\n        message.includes('not found') || message.includes('access denied')\n          ? 404\n          : 500;\n      res.status(status).json({ error: message });\n    }\n  }\n);\n\n// Update widget\nrouter.put(\n  '/:id',\n  requireAuth,\n  requireOrgAccess,\n  requirePermission(Permission.WIDGET_WRITE),\n  logDataAccess('widgets', 'UPDATE'),\n  async (req, res) => {\n    try {\n      const widget = await widgetService.updateWidget(\n        req.params.id,\n        req.organizationId!,\n        req.body\n      );\n      res.json(widget);\n    } catch (error) {\n      const message =\n        error instanceof Error ? error.message : 'Failed to update widget';\n      const status =\n        message.includes('not found') || message.includes('access denied')\n          ? 404\n          : 500;\n      res.status(status).json({ error: message });\n    }\n  }\n);\n\n// Delete widget\nrouter.delete(\n  '/:id',\n  requireAuth,\n  requireOrgAccess,\n  requirePermission(Permission.WIDGET_DELETE),\n  logDataAccess('widgets', 'DELETE'),\n  async (req, res) => {\n    try {\n      await widgetService.deleteWidget(req.params.id, req.organizationId!);\n      res.status(204).send();\n    } catch (error) {\n      const message =\n        error instanceof Error ? error.message : 'Failed to delete widget';\n      const status =\n        message.includes('not found') || message.includes('access denied')\n          ? 404\n          : 500;\n      res.status(status).json({ error: message });\n    }\n  }\n);\n\n// Get widget analytics\nrouter.get(\n  '/:id/analytics',\n  requireAuth,\n  requireOrgAccess,\n  requirePermission(Permission.ANALYTICS_READ),\n  logDataAccess('analytics', 'SELECT'),\n  async (req, res) => {\n    try {\n      const analytics = await widgetService.getWidgetAnalytics(\n        req.params.id,\n        req.organizationId!\n      );\n      res.json(analytics);\n    } catch (error) {\n      const message =\n        error instanceof Error\n          ? error.message\n          : 'Failed to fetch widget analytics';\n      const status =\n        message.includes('not found') || message.includes('access denied')\n          ? 404\n          : 500;\n      res.status(status).json({ error: message });\n    }\n  }\n);\n\nexport default router;\n"],"version":3}