7d8158954a61e6d0be5057a14f2c8e95
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.mockAuthUser = void 0;
// Mock Prisma
jest.mock('../src/lib/prisma');
// Mock Redis
jest.mock('ioredis');
// Mock services
jest.mock('../src/services/widgetService');
// Mock logger to reduce noise in tests
jest.mock('../src/lib/logger', () => ({
    logger: {
        info: jest.fn(),
        error: jest.fn(),
        warn: jest.fn(),
        debug: jest.fn(),
    },
}));
// Mock OpenAI
jest.mock('openai', () => ({
    default: jest.fn().mockImplementation(() => ({
        chat: {
            completions: {
                create: jest.fn().mockResolvedValue({
                    choices: [
                        {
                            message: {
                                content: 'Mock AI response',
                                role: 'assistant',
                            },
                        },
                    ],
                }),
            },
        },
        embeddings: {
            create: jest.fn().mockResolvedValue({
                data: [
                    {
                        embedding: new Array(1536).fill(0.1),
                    },
                ],
            }),
        },
    })),
}));
// Mock Stripe
jest.mock('stripe', () => ({
    default: jest.fn().mockImplementation(() => ({
        customers: {
            create: jest.fn().mockResolvedValue({ id: 'cus_test' }),
            retrieve: jest.fn().mockResolvedValue({ id: 'cus_test' }),
            update: jest.fn().mockResolvedValue({ id: 'cus_test' }),
        },
        prices: {
            list: jest.fn().mockResolvedValue({
                data: [
                    {
                        id: 'price_test',
                        product: 'prod_test',
                        unit_amount: 1000,
                        currency: 'usd',
                        recurring: { interval: 'month' },
                    },
                ],
            }),
        },
        subscriptions: {
            create: jest.fn().mockResolvedValue({ id: 'sub_test' }),
            retrieve: jest.fn().mockResolvedValue({ id: 'sub_test' }),
            update: jest.fn().mockResolvedValue({ id: 'sub_test' }),
            cancel: jest.fn().mockResolvedValue({ id: 'sub_test' }),
        },
        checkout: {
            sessions: {
                create: jest.fn().mockResolvedValue({
                    id: 'cs_test',
                    url: 'https://checkout.stripe.com/test',
                }),
            },
        },
        billingPortal: {
            sessions: {
                create: jest
                    .fn()
                    .mockResolvedValue({ url: 'https://billing.stripe.com/test' }),
            },
        },
        webhookEndpoints: {
            create: jest.fn().mockResolvedValue({ id: 'we_test' }),
        },
    })),
}));
// Mock SendGrid
jest.mock('@sendgrid/mail', () => ({
    setApiKey: jest.fn(),
    send: jest.fn().mockResolvedValue([{}]),
}));
// Mock Qdrant
jest.mock('@qdrant/js-client-rest', () => ({
    QdrantClient: jest.fn().mockImplementation(() => ({
        createCollection: jest.fn().mockResolvedValue(true),
        getCollection: jest.fn().mockResolvedValue({ status: 'green' }),
        upsert: jest.fn().mockResolvedValue({ operation_id: 1 }),
        search: jest.fn().mockResolvedValue({
            result: [
                {
                    id: 'vec-1',
                    score: 0.95,
                    payload: {
                        content: 'Test content',
                        metadata: {},
                    },
                },
            ],
        }),
        delete: jest.fn().mockResolvedValue({ operation_id: 1 }),
    })),
}));
// Mock AWS SDK
jest.mock('@aws-sdk/client-s3', () => ({
    S3Client: jest.fn(),
    PutObjectCommand: jest.fn(),
    GetObjectCommand: jest.fn(),
    DeleteObjectCommand: jest.fn(),
}));
// Mock Socket.IO
jest.mock('socket.io', () => {
    const mockSocket = {
        id: 'test-socket-id',
        emit: jest.fn(),
        on: jest.fn(),
        join: jest.fn(),
        leave: jest.fn(),
        disconnect: jest.fn(),
    };
    const mockIo = {
        on: jest.fn((event, handler) => {
            if (event === 'connection') {
                // Simulate a connection
                setImmediate(() => handler(mockSocket));
            }
        }),
        emit: jest.fn(),
        to: jest.fn(() => mockIo),
        in: jest.fn(() => mockIo),
        sockets: {
            sockets: new Map([[mockSocket.id, mockSocket]]),
        },
    };
    return {
        Server: jest.fn(() => mockIo),
    };
});
// Set up test environment
require("reflect-metadata");
const util_1 = require("util");
// Set environment variables for tests
process.env.NODE_ENV = 'test';
process.env.DATABASE_URL = 'postgresql://test:test@localhost:5432/test';
process.env.JWT_SECRET = 'test-secret-key';
process.env.STRIPE_SECRET_KEY = 'sk_test_mock';
process.env.SENDGRID_API_KEY = 'SG.test-key';
process.env.QDRANT_URL = 'http://localhost:6333';
process.env.QDRANT_API_KEY = 'test-qdrant-key';
process.env.AWS_ACCESS_KEY_ID = 'test-aws-key';
process.env.AWS_SECRET_ACCESS_KEY = 'test-aws-secret';
process.env.AWS_REGION = 'us-east-1';
process.env.S3_BUCKET_NAME = 'test-bucket';
process.env.REDIS_URL = 'redis://localhost:6379';
process.env.OPENAI_API_KEY = 'sk-test-mock';
// Mock global objects
global.TextEncoder = util_1.TextEncoder;
global.TextDecoder = util_1.TextDecoder;
// Clean up after each test
afterEach(() => {
    jest.clearAllMocks();
});
// Global test timeout
jest.setTimeout(30000);
// Test helpers
exports.mockAuthUser = {
    id: 'test-user-id',
    email: 'test@example.com',
    organizationId: 'test-org-id',
    roles: ['admin'],
};
// Mock date for consistent testing
const mockDate = new Date('2024-01-01T00:00:00Z');
jest.useFakeTimers();
jest.setSystemTime(mockDate);
// Helper to reset all mocks
global.resetAllMocks = () => {
    jest.clearAllMocks();
    jest.clearAllTimers();
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3l1c3VrZXlvc2hpb2thL3Byb2plY3RzL3lvdXR1YmUvYWktY2hhdC9haS1jaGF0LWFwaS90ZXN0cy9zZXR1cC50cyIsIm1hcHBpbmdzIjoiOzs7QUF1QkEsY0FBYztBQUNkLElBQUksQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FBQztBQUUvQixhQUFhO0FBQ2IsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUVyQixnQkFBZ0I7QUFDaEIsSUFBSSxDQUFDLElBQUksQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO0FBRTNDLHVDQUF1QztBQUN2QyxJQUFJLENBQUMsSUFBSSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDcEMsTUFBTSxFQUFFO1FBQ04sSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNoQixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNmLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ2pCO0NBQ0YsQ0FBQyxDQUFDLENBQUM7QUFFSixjQUFjO0FBQ2QsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUN6QixPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDM0MsSUFBSSxFQUFFO1lBQ0osV0FBVyxFQUFFO2dCQUNYLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUM7b0JBQ2xDLE9BQU8sRUFBRTt3QkFDUDs0QkFDRSxPQUFPLEVBQUU7Z0NBQ1AsT0FBTyxFQUFFLGtCQUFrQjtnQ0FDM0IsSUFBSSxFQUFFLFdBQVc7NkJBQ2xCO3lCQUNGO3FCQUNGO2lCQUNGLENBQUM7YUFDSDtTQUNGO1FBQ0QsVUFBVSxFQUFFO1lBQ1YsTUFBTSxFQUFFLElBQUksQ0FBQyxF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QUFDLEtBQUssQ0FBQyxDQUFDO0FBRXZCLGVBQWU7QUFDRixRQUFBLFlBQVksR0FBRztJQUMxQixFQUFFLEVBQUUsY0FBYztJQUNsQixLQUFLLEVBQUUsa0JBQWtCO0lBQ3pCLGNBQWMsRUFBRSxhQUFhO0lBQzdCLEtBQUssRUFBRSxDQUFDLE9BQU8sQ0FBQztDQUNqQixDQUFDO0FBRUYsbUNBQW1DO0FBQ25DLE1BQU0sUUFBUSxHQUFHLElBQUksSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUM7QUFDbEQsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0FBQ3JCLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7QUFFN0IsNEJBQTRCO0FBQzNCLE1BQWMsQ0FBQyxhQUFhLEdBQUcsR0FBRyxFQUFFO0lBQ25DLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUNyQixJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7QUFDeEIsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy95dXN1a2V5b3NoaW9rYS9wcm9qZWN0cy95b3V0dWJlL2FpLWNoYXQvYWktY2hhdC1hcGkvdGVzdHMvc2V0dXAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gU2V0IHVwIHRlc3QgZW52aXJvbm1lbnRcbmltcG9ydCAncmVmbGVjdC1tZXRhZGF0YSc7XG5pbXBvcnQgeyBUZXh0RW5jb2RlciwgVGV4dERlY29kZXIgfSBmcm9tICd1dGlsJztcblxuLy8gU2V0IGVudmlyb25tZW50IHZhcmlhYmxlcyBmb3IgdGVzdHNcbnByb2Nlc3MuZW52Lk5PREVfRU5WID0gJ3Rlc3QnO1xucHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMID0gJ3Bvc3RncmVzcWw6Ly90ZXN0OnRlc3RAbG9jYWxob3N0OjU0MzIvdGVzdCc7XG5wcm9jZXNzLmVudi5KV1RfU0VDUkVUID0gJ3Rlc3Qtc2VjcmV0LWtleSc7XG5wcm9jZXNzLmVudi5TVFJJUEVfU0VDUkVUX0tFWSA9ICdza190ZXN0X21vY2snO1xucHJvY2Vzcy5lbnYuU0VOREdSSURfQVBJX0tFWSA9ICdTRy50ZXN0LWtleSc7XG5wcm9jZXNzLmVudi5RRFJBTlRfVVJMID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6NjMzMyc7XG5wcm9jZXNzLmVudi5RRFJBTlRfQVBJX0tFWSA9ICd0ZXN0LXFkcmFudC1rZXknO1xucHJvY2Vzcy5lbnYuQVdTX0FDQ0VTU19LRVlfSUQgPSAndGVzdC1hd3Mta2V5JztcbnByb2Nlc3MuZW52LkFXU19TRUNSRVRfQUNDRVNTX0tFWSA9ICd0ZXN0LWF3cy1zZWNyZXQnO1xucHJvY2Vzcy5lbnYuQVdTX1JFR0lPTiA9ICd1cy1lYXN0LTEnO1xucHJvY2Vzcy5lbnYuUzNfQlVDS0VUX05BTUUgPSAndGVzdC1idWNrZXQnO1xucHJvY2Vzcy5lbnYuUkVESVNfVVJMID0gJ3JlZGlzOi8vbG9jYWxob3N0OjYzNzknO1xucHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVkgPSAnc2stdGVzdC1tb2NrJztcblxuLy8gTW9jayBnbG9iYWwgb2JqZWN0c1xuZ2xvYmFsLlRleHRFbmNvZGVyID0gVGV4dEVuY29kZXI7XG5nbG9iYWwuVGV4dERlY29kZXIgPSBUZXh0RGVjb2RlciBhcyBhbnk7XG5cbi8vIE1vY2sgUHJpc21hXG5qZXN0Lm1vY2soJy4uL3NyYy9saWIvcHJpc21hJyk7XG5cbi8vIE1vY2sgUmVkaXNcbmplc3QubW9jaygnaW9yZWRpcycpO1xuXG4vLyBNb2NrIHNlcnZpY2VzXG5qZXN0Lm1vY2soJy4uL3NyYy9zZXJ2aWNlcy93aWRnZXRTZXJ2aWNlJyk7XG5cbi8vIE1vY2sgbG9nZ2VyIHRvIHJlZHVjZSBub2lzZSBpbiB0ZXN0c1xuamVzdC5tb2NrKCcuLi9zcmMvbGliL2xvZ2dlcicsICgpID0+ICh7XG4gIGxvZ2dlcjoge1xuICAgIGluZm86IGplc3QuZm4oKSxcbiAgICBlcnJvcjogamVzdC5mbigpLFxuICAgIHdhcm46IGplc3QuZm4oKSxcbiAgICBkZWJ1ZzogamVzdC5mbigpLFxuICB9LFxufSkpO1xuXG4vLyBNb2NrIE9wZW5BSVxuamVzdC5tb2NrKCdvcGVuYWknLCAoKSA9PiAoe1xuICBkZWZhdWx0OiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgY2hhdDoge1xuICAgICAgY29tcGxldGlvbnM6IHtcbiAgICAgICAgY3JlYXRlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgIGNob2ljZXM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgbWVzc2FnZToge1xuICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICdNb2NrIEFJIHJlc3BvbnNlJyxcbiAgICAgICAgICAgICAgICByb2xlOiAnYXNzaXN0YW50JyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgfSksXG4gICAgICB9LFxuICAgIH0sXG4gICAgZW1iZWRkaW5nczoge1xuICAgICAgY3JlYXRlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBkYXRhOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgZW1iZWRkaW5nOiBuZXcgQXJyYXkoMTUzNikuZmlsbCgwLjEpLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICB9KSxcbiAgICB9LFxuICB9KSksXG59KSk7XG5cbi8vIE1vY2sgU3RyaXBlXG5qZXN0Lm1vY2soJ3N0cmlwZScsICgpID0+ICh7XG4gIGRlZmF1bHQ6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgICBjdXN0b21lcnM6IHtcbiAgICAgIGNyZWF0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgaWQ6ICdjdXNfdGVzdCcgfSksXG4gICAgICByZXRyaWV2ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgaWQ6ICdjdXNfdGVzdCcgfSksXG4gICAgICB1cGRhdGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGlkOiAnY3VzX3Rlc3QnIH0pLFxuICAgIH0sXG4gICAgcHJpY2VzOiB7XG4gICAgICBsaXN0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBkYXRhOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgaWQ6ICdwcmljZV90ZXN0JyxcbiAgICAgICAgICAgIHByb2R1Y3Q6ICdwcm9kX3Rlc3QnLFxuICAgICAgICAgICAgdW5pdF9hbW91bnQ6IDEwMDAsXG4gICAgICAgICAgICBjdXJyZW5jeTogJ3VzZCcsXG4gICAgICAgICAgICByZWN1cnJpbmc6IHsgaW50ZXJ2YWw6ICdtb250aCcgfSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfSksXG4gICAgfSxcbiAgICBzdWJzY3JpcHRpb25zOiB7XG4gICAgICBjcmVhdGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGlkOiAnc3ViX3Rlc3QnIH0pLFxuICAgICAgcmV0cmlldmU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGlkOiAnc3ViX3Rlc3QnIH0pLFxuICAgICAgdXBkYXRlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBpZDogJ3N1Yl90ZXN0JyB9KSxcbiAgICAgIGNhbmNlbDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgaWQ6ICdzdWJfdGVzdCcgfSksXG4gICAgfSxcbiAgICBjaGVja291dDoge1xuICAgICAgc2Vzc2lvbnM6IHtcbiAgICAgICAgY3JlYXRlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgIGlkOiAnY3NfdGVzdCcsXG4gICAgICAgICAgdXJsOiAnaHR0cHM6Ly9jaGVja291dC5zdHJpcGUuY29tL3Rlc3QnLFxuICAgICAgICB9KSxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBiaWxsaW5nUG9ydGFsOiB7XG4gICAgICBzZXNzaW9uczoge1xuICAgICAgICBjcmVhdGU6IGplc3RcbiAgICAgICAgICAuZm4oKVxuICAgICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHVybDogJ2h0dHBzOi8vYmlsbGluZy5zdHJpcGUuY29tL3Rlc3QnIH0pLFxuICAgICAgfSxcbiAgICB9LFxuICAgIHdlYmhvb2tFbmRwb2ludHM6IHtcbiAgICAgIGNyZWF0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgaWQ6ICd3ZV90ZXN0JyB9KSxcbiAgICB9LFxuICB9KSksXG59KSk7XG5cbi8vIE1vY2sgU2VuZEdyaWRcbmplc3QubW9jaygnQHNlbmRncmlkL21haWwnLCAoKSA9PiAoe1xuICBzZXRBcGlLZXk6IGplc3QuZm4oKSxcbiAgc2VuZDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKFt7fV0pLFxufSkpO1xuXG4vLyBNb2NrIFFkcmFudFxuamVzdC5tb2NrKCdAcWRyYW50L2pzLWNsaWVudC1yZXN0JywgKCkgPT4gKHtcbiAgUWRyYW50Q2xpZW50OiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgY3JlYXRlQ29sbGVjdGlvbjogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpLFxuICAgIGdldENvbGxlY3Rpb246IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHN0YXR1czogJ2dyZWVuJyB9KSxcbiAgICB1cHNlcnQ6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IG9wZXJhdGlvbl9pZDogMSB9KSxcbiAgICBzZWFyY2g6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICByZXN1bHQ6IFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAndmVjLTEnLFxuICAgICAgICAgIHNjb3JlOiAwLjk1LFxuICAgICAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgICAgIGNvbnRlbnQ6ICdUZXN0IGNvbnRlbnQnLFxuICAgICAgICAgICAgbWV0YWRhdGE6IHt9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pLFxuICAgIGRlbGV0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgb3BlcmF0aW9uX2lkOiAxIH0pLFxuICB9KSksXG59KSk7XG5cbi8vIE1vY2sgQVdTIFNES1xuamVzdC5tb2NrKCdAYXdzLXNkay9jbGllbnQtczMnLCAoKSA9PiAoe1xuICBTM0NsaWVudDogamVzdC5mbigpLFxuICBQdXRPYmplY3RDb21tYW5kOiBqZXN0LmZuKCksXG4gIEdldE9iamVjdENvbW1hbmQ6IGplc3QuZm4oKSxcbiAgRGVsZXRlT2JqZWN0Q29tbWFuZDogamVzdC5mbigpLFxufSkpO1xuXG4vLyBNb2NrIFNvY2tldC5JT1xuamVzdC5tb2NrKCdzb2NrZXQuaW8nLCAoKSA9PiB7XG4gIGNvbnN0IG1vY2tTb2NrZXQgPSB7XG4gICAgaWQ6ICd0ZXN0LXNvY2tldC1pZCcsXG4gICAgZW1pdDogamVzdC5mbigpLFxuICAgIG9uOiBqZXN0LmZuKCksXG4gICAgam9pbjogamVzdC5mbigpLFxuICAgIGxlYXZlOiBqZXN0LmZuKCksXG4gICAgZGlzY29ubmVjdDogamVzdC5mbigpLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tJbzogYW55ID0ge1xuICAgIG9uOiBqZXN0LmZuKChldmVudDogc3RyaW5nLCBoYW5kbGVyOiAoc29ja2V0OiBhbnkpID0+IHZvaWQpID0+IHtcbiAgICAgIGlmIChldmVudCA9PT0gJ2Nvbm5lY3Rpb24nKSB7XG4gICAgICAgIC8vIFNpbXVsYXRlIGEgY29ubmVjdGlvblxuICAgICAgICBzZXRJbW1lZGlhdGUoKCkgPT4gaGFuZGxlcihtb2NrU29ja2V0KSk7XG4gICAgICB9XG4gICAgfSksXG4gICAgZW1pdDogamVzdC5mbigpLFxuICAgIHRvOiBqZXN0LmZuKCgpID0+IG1vY2tJbyksXG4gICAgaW46IGplc3QuZm4oKCkgPT4gbW9ja0lvKSxcbiAgICBzb2NrZXRzOiB7XG4gICAgICBzb2NrZXRzOiBuZXcgTWFwKFtbbW9ja1NvY2tldC5pZCwgbW9ja1NvY2tldF1dKSxcbiAgICB9LFxuICB9O1xuXG4gIHJldHVybiB7XG4gICAgU2VydmVyOiBqZXN0LmZuKCgpID0+IG1vY2tJbyksXG4gIH07XG59KTtcblxuLy8gQ2xlYW4gdXAgYWZ0ZXIgZWFjaCB0ZXN0XG5hZnRlckVhY2goKCkgPT4ge1xuICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbn0pO1xuXG4vLyBHbG9iYWwgdGVzdCB0aW1lb3V0XG5qZXN0LnNldFRpbWVvdXQoMzAwMDApO1xuXG4vLyBUZXN0IGhlbHBlcnNcbmV4cG9ydCBjb25zdCBtb2NrQXV0aFVzZXIgPSB7XG4gIGlkOiAndGVzdC11c2VyLWlkJyxcbiAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgb3JnYW5pemF0aW9uSWQ6ICd0ZXN0LW9yZy1pZCcsXG4gIHJvbGVzOiBbJ2FkbWluJ10sXG59O1xuXG4vLyBNb2NrIGRhdGUgZm9yIGNvbnNpc3RlbnQgdGVzdGluZ1xuY29uc3QgbW9ja0RhdGUgPSBuZXcgRGF0ZSgnMjAyNC0wMS0wMVQwMDowMDowMFonKTtcbmplc3QudXNlRmFrZVRpbWVycygpO1xuamVzdC5zZXRTeXN0ZW1UaW1lKG1vY2tEYXRlKTtcblxuLy8gSGVscGVyIHRvIHJlc2V0IGFsbCBtb2Nrc1xuKGdsb2JhbCBhcyBhbnkpLnJlc2V0QWxsTW9ja3MgPSAoKSA9PiB7XG4gIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICBqZXN0LmNsZWFyQWxsVGltZXJzKCk7XG59O1xuIl0sInZlcnNpb24iOjN9