{"version":3,"names":["cov_27e1c0g4hn","actualCoverage","bull_1","s","__importDefault","require","trainingService_1","logger_1","exports","trainingQueue","default","redis","host","b","process","env","REDIS_HOST","port","parseInt","REDIS_PORT","job","f","__awaiter","feedbackId","messageId","feedback","originalQuery","originalResponse","widgetId","data","logger","info","jobId","id","improveResponse","error"],"sources":["/Users/yusukeyoshioka/projects/youtube/ai-chat/ai-chat-api/src/jobs/trainingQueue.ts"],"sourcesContent":["import Bull from 'bull';\nimport { improveResponse } from '../services/trainingService';\nimport { logger } from '../lib/logger';\n\nexport const trainingQueue = new Bull('training', {\n  redis: {\n    host: process.env.REDIS_HOST || 'localhost',\n    port: parseInt(process.env.REDIS_PORT || '6379'),\n  },\n});\n\n// 改善提案生成ワーカー\ntrainingQueue.process('improve-response', async (job) => {\n  const {\n    feedbackId,\n    messageId,\n    feedback,\n    originalQuery,\n    originalResponse,\n    widgetId,\n  } = job.data;\n\n  logger.info('Processing feedback improvement', {\n    jobId: job.id,\n    feedbackId,\n  });\n\n  try {\n    await improveResponse({\n      feedbackId,\n      messageId,\n      feedback,\n      originalQuery,\n      originalResponse,\n      widgetId,\n    });\n\n    logger.info('Feedback improvement completed', { feedbackId });\n  } catch (error) {\n    logger.error('Failed to process feedback improvement', {\n      error,\n      feedbackId,\n    });\n    throw error;\n  }\n});\n"],"mappings":"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","ignoreList":[]}