{"version":3,"names":["cov_1d1ekgr4vc","actualCoverage","jsonwebtoken_1","s","__importDefault","require","signToken","user","res","f","process","env","JWT_SECRET","b","Error","token","default","sign","id","email","isAdmin","expiresIn","cookie","httpOnly","maxAge","secure","NODE_ENV","sameSite","exports","verifyToken","decoded","verify","error","name"],"sources":["/Users/yusukeyoshioka/projects/youtube/ai-chat/ai-chat-api/src/utils/jwt.ts"],"sourcesContent":["import jwt from 'jsonwebtoken';\nimport { Response } from 'express';\n\n// User interface (simplified)\nexport interface UserPayload {\n  id: string;\n  email: string;\n  isAdmin?: boolean;\n}\n\n// Sign JWT token and store in HTTP-Only Cookie\nexport const signToken = (user: UserPayload, res: Response): string => {\n  if (!process.env.JWT_SECRET) {\n    throw new Error('JWT_SECRET is not defined in environment variables');\n  }\n\n  const token = jwt.sign(\n    { id: user.id, email: user.email, isAdmin: user.isAdmin },\n    process.env.JWT_SECRET,\n    { expiresIn: '7d' }\n  );\n\n  // Set HTTP-Only cookie\n  res.cookie('token', token, {\n    httpOnly: true,\n    maxAge: 7 * 24 * 60 * 60 * 1000, // 7 days\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: process.env.NODE_ENV === 'production' ? 'strict' : 'lax',\n  });\n\n  return token;\n};\n\n// Verify JWT token\nexport const verifyToken = (token: string): UserPayload => {\n  if (!process.env.JWT_SECRET) {\n    throw new Error('JWT_SECRET is not defined in environment variables');\n  }\n\n  try {\n    const decoded = jwt.verify(token, process.env.JWT_SECRET) as UserPayload;\n    return decoded;\n  } catch (error) {\n    if (error instanceof Error && error.name === 'TokenExpiredError') {\n      throw new Error('jwt expired');\n    }\n    throw new Error('Invalid token');\n  }\n};\n"],"mappings":"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","ignoreList":[]}