{"version":3,"names":["cov_1qyyxvqdwo","actualCoverage","express_1","s","require","auth_1","metrics_1","prisma_1","router","Router","use","authMiddleware","metricsMiddleware","get","req","res","f","__awaiter","twentyFourHoursAgo","Date","now","totalChats","activeUsers","recentChats","Promise","all","prisma","chatLog","count","user","where","chatLogs","some","createdAt","gte","findMany","select","avgResponseTime","_totalMessages","length","errorRate","json","Math","round","timestamp","toISOString","error","console","status","exports","default"],"sources":["/Users/yusukeyoshioka/projects/youtube/ai-chat/ai-chat-api/src/routes/dashboard.ts"],"sourcesContent":["import { Router, Request, Response } from 'express';\nimport { authMiddleware } from '../middleware/auth';\nimport { metricsMiddleware } from '../middleware/metrics';\nimport { prisma } from '../lib/prisma';\n\nconst router = Router();\n\nrouter.use(authMiddleware);\nrouter.use(metricsMiddleware);\n\nrouter.get('/', async (req: Request, res: Response) => {\n  try {\n    const twentyFourHoursAgo = new Date(Date.now() - 24 * 60 * 60 * 1000);\n\n    const [totalChats, activeUsers, recentChats] = await Promise.all([\n      prisma.chatLog.count(),\n      prisma.user.count({\n        where: {\n          chatLogs: {\n            some: {\n              createdAt: {\n                gte: twentyFourHoursAgo,\n              },\n            },\n          },\n        },\n      }),\n      prisma.chatLog.findMany({\n        where: {\n          createdAt: {\n            gte: twentyFourHoursAgo,\n          },\n        },\n        select: {\n          createdAt: true,\n        },\n      }),\n    ]);\n\n    const avgResponseTime = 250;\n\n    const _totalMessages = recentChats.length;\n    const errorRate = 0.02;\n\n    res.json({\n      totalChats,\n      activeUsers,\n      avgResponseTime: Math.round(avgResponseTime),\n      errorRate: Math.round(errorRate * 1000) / 1000,\n      timestamp: new Date().toISOString(),\n    });\n  } catch (error) {\n    console.error('Dashboard error:', error);\n    res.status(500).json({ error: 'Failed to fetch dashboard data' });\n  }\n});\n\nexport default router;\n"],"mappings":"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","ignoreList":[]}