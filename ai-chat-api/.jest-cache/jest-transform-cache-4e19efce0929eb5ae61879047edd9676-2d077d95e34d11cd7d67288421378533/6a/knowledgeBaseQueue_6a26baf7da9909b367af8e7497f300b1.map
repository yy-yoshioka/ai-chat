{"version":3,"names":["cov_1361zkpbye","actualCoverage","bull_1","s","__importDefault","require","knowledgeBaseService_1","logger_1","exports","knowledgeBaseQueue","default","redis","host","b","process","env","REDIS_HOST","port","parseInt","REDIS_PORT","job","f","__awaiter","knowledgeBaseId","s3Key","mimeType","data","logger","info","jobId","id","processKnowledgeBaseFile","error","on","progress"],"sources":["/Users/yusukeyoshioka/projects/youtube/ai-chat/ai-chat-api/src/jobs/knowledgeBaseQueue.ts"],"sourcesContent":["import Bull from 'bull';\nimport { processKnowledgeBaseFile } from '../services/knowledgeBaseService';\nimport { logger } from '../lib/logger';\n\nexport const knowledgeBaseQueue = new Bull('knowledge-base', {\n  redis: {\n    host: process.env.REDIS_HOST || 'localhost',\n    port: parseInt(process.env.REDIS_PORT || '6379'),\n  },\n});\n\n// ファイル処理ワーカー\nknowledgeBaseQueue.process('process-file', async (job) => {\n  const { knowledgeBaseId, s3Key, mimeType } = job.data;\n\n  logger.info('Processing knowledge base file', {\n    jobId: job.id,\n    knowledgeBaseId,\n  });\n\n  try {\n    await processKnowledgeBaseFile(knowledgeBaseId, s3Key, mimeType);\n    logger.info('Knowledge base file processed', { knowledgeBaseId });\n  } catch (error) {\n    logger.error('Failed to process knowledge base file', {\n      error,\n      knowledgeBaseId,\n    });\n    throw error;\n  }\n});\n\n// 進捗更新\nknowledgeBaseQueue.on('progress', (job, progress) => {\n  logger.info('Job progress', { jobId: job.id, progress });\n});\n"],"mappings":"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","ignoreList":[]}