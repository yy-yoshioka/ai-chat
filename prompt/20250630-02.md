```bash
# =====================================================================
#  🚀  Claude Code RUNBOOK  –  ai-chat / ai-chat-ui Monorepo
#  (基点ブランチ: develop)
# =====================================================================
#  🎯 GLOBAL GOALS
#    1. すべての TODO をクリアして  yarn lint / yarn build = Error 0
#    2. 作業は feature/<todo-key> ← develop で行い、PR も develop 向け
#    3. 各ステップの START / DONE / FAIL と PR READY を Slack #dev-ci に通知
#
# =====================================================================
#  🗂️  REPO STRUCTURE（抜粋）
#    ai-chat         … Express API
#    ai-chat-ui      … Next.js App Router (BFF)
#      ├─ app/api/bff/**        ← BFF ルート
#      ├─ app/_schemas/**       ← Zod スキーマ専用
#      ├─ app/_utils/fetcher.ts ← fetch ラッパ
#      └─ scripts/slack-notify.sh
#
# =====================================================================
#  ⚙️  CLAUDE CODE SETTINGS
#  permissions.json
#  -----------------
#  {
#    "permissions": { "allow": ["Bash(*)","Git(*)","Yarn(*)","Docker(*)","Node(*)"], "deny": [] },
#    "auto_confirm": true
#  }
#
# =====================================================================
#  🔔  SLACK NOTIFY RULE
#    ./scripts/slack-notify.sh "START <todo-key>"
#    ./scripts/slack-notify.sh "DONE  <todo-key>"
#    ./scripts/slack-notify.sh "FAIL  <todo-key> : <stderr>"
#    ./scripts/slack-notify.sh "PR READY <branch>"
#
# =====================================================================
#  🌳  GIT WORKFLOW
#    • ブランチ : feature/<todo-key>  （develop から作成）
#    • Commit : <type>(<scope>): <subject>   例) feat(api): dashboard route
#      - type  = feat / fix / refactor / chore / test / docs
#      - scope = api | ui | hook | schema | config | infra
#      - 末尾に「#CI」で GitHub Actions 実行
#
# =====================================================================
#  🛡️  CODING RULE DIGEST
#    • fetch 直呼び禁止  → 必ず app/_utils/fetcher.ts 経由
#    • Zod 宣言          → app/_schemas/** のみ
#    • npm / pnpm 禁止   → Yarn 固定
#    • ESLint            → max-lines-per-function 100 / jsx-max-depth 5
#    • eslint-disable    → 原則禁止
#
# =====================================================================
#  🪜  TODO ROADMAP  （全 17 セクション  + Finalize）
# =====================================================================

# ---------------------------------------------------------------------
# ■ Section-0   chore: init phase-1 branch                  <todo-key> phase1-init
# ---------------------------------------------------------------------
#   • develop から feature/phase1-impl を作成
#   • 空 commit を作り Slack 通知 START / DONE
#
# ---------------------------------------------------------------------
# ■ Section-0.5 infra-ci                                   <todo-key> infra-ci
# ---------------------------------------------------------------------
#   • Docker Compose（PostgreSQL / Redis / Pinecone or Qdrant）
#   • .env.example 追加、GitHub Actions で lint / build / test / e2e / preview
#
# ---------------------------------------------------------------------
# ■ Section-0.6 error-logging                              <todo-key> error-logging
# ---------------------------------------------------------------------
#   • グローバルエラーハンドラ・Sentry 初期化・JSON ログ
#   • /healthz で 200 を返す
#
# ---------------------------------------------------------------------
# ■ Section-1   feat(kb): KB アップロード基盤              <todo-key> kb-upload
# ---------------------------------------------------------------------
#   • Prisma KnowledgeBase モデル
#   • /knowledge-base/upload|items|delete（Express+BFF）
#   • S3 保存まで実装、UI Uploader 雛形
#
# ---------------------------------------------------------------------
# ■ Section-1b  feat(kb): ベクトル化 & RAG 検索            <todo-key> kb-rag
# ---------------------------------------------------------------------
#   • BullMQ ワーカーで chunk→embedding→VectorDB
#   • /knowledge-base/train|status 追加、チャット API が KB 参照
#
# ---------------------------------------------------------------------
# ■ Section-2   feat(feedback): 改善ループ                 <todo-key> training-feedback
# ---------------------------------------------------------------------
#   • /training/feedback（Express+BFF）
#   • BullMQ training-feedback キュー
#   • useFeedback Hook 雛形
#
# ---------------------------------------------------------------------
# ■ Section-3   feat(analytics): 会話分析 & 未解決         <todo-key> analytics-base
# ---------------------------------------------------------------------
#   • /analytics/conversation-flow & /analytics/unresolved（Express+BFF）
#   • ダッシュボード土台 & useAnalytics Hook
#
# ---------------------------------------------------------------------
# ■ Section-4   feat(users): 詳細・招待                    <todo-key> user-management
# ---------------------------------------------------------------------
#   • UserDetailView / InviteUserModal / UserPermissionsEditor
#   • BFF /users/[id] /users/invite 補完
#
# ---------------------------------------------------------------------
# ■ Section-5   feat(auth): パスリセット & 認証強化        <todo-key> auth-flow
# ---------------------------------------------------------------------
#   • Forgot / Reset / Verify ページ & BFF ルート
#
# ---------------------------------------------------------------------
# ■ Section-6   feat(settings): 各種設定 + 通知            <todo-key> settings-suite
# ---------------------------------------------------------------------
#   • Settings ページ群・NotificationCenter・useNotifications
#   • BFF /settings /notifications /logs
#
# ---------------------------------------------------------------------
# ■ Section-7   feat(org): Org & Widget 拡充               <todo-key> org-widgets
# ---------------------------------------------------------------------
#   • Organizations List + Widgets BFF 欠損補完
#
# ---------------------------------------------------------------------
# ■ Section-8   feat(reports): Export                      <todo-key> reports-export
# ---------------------------------------------------------------------
#   • /reports/export BFF・CSV ダウンロード UI
#
# ---------------------------------------------------------------------
# ■ Section-9   feat(schema): Zod 追加 & バリデーション     <todo-key> schema-ratchet
# ---------------------------------------------------------------------
#   • 欠品スキーマ追加・BFF safeParse 呼び出し
#
# ---------------------------------------------------------------------
# ■ Section-10  test: ユニット & E2E 雛形                  <todo-key> tests-placeholder
# ---------------------------------------------------------------------
#   • Jest/Supertest と Playwright の骨組み
#
# ---------------------------------------------------------------------
# ■ Section-11  feat(webhook): Webhook Suite               <todo-key> webhook-suite
# ---------------------------------------------------------------------
#   • /webhooks CRUD & ログ、設定 UI、useWebhooks Hook
#
# ---------------------------------------------------------------------
# ■ Section-12  feat(status): System Health                <todo-key> system-health
# ---------------------------------------------------------------------
#   • /status/metrics → SLA ダッシュボード、OTel Export
#
# ---------------------------------------------------------------------
# ■ Section-13  docs: OpenAPI & JS SDK                     <todo-key> openapi-sdk
# ---------------------------------------------------------------------
#   • openapi.yml 骨子・SDK 生成スクリプト雛形
#
# ---------------------------------------------------------------------
# ■ Section-14  docs: Storybook & アーキ文書               <todo-key> storybook-docs
# ---------------------------------------------------------------------
#   • Storybook 初期化・docs/architecture.md 草稿
#
# ---------------------------------------------------------------------
# ■ Section-15  chore: Data Retention Job                  <todo-key> data-retention
# ---------------------------------------------------------------------
#   • 古いチャット削除ジョブ雛形・Retention 設定
#
# ---------------------------------------------------------------------
# ■ Section-16  feat(security): Multi-tenancy 強化         <todo-key> security-hardening
# ---------------------------------------------------------------------
#   • Storage & VectorDB 隔離、RBAC Middleware 下地
#
# ---------------------------------------------------------------------
# ■ Section-17  chore: Technical Debt Sprint               <todo-key> tech-debt
# ---------------------------------------------------------------------
#   • TODO コメント解消・循環 import 撲滅・型補完
#
# =====================================================================
#  🔚  FINALIZE
# ---------------------------------------------------------------------
slack-notify START finalize
git checkout develop
git merge --no-ff feature/phase1-impl
yarn format && yarn lint && yarn build && yarn test && yarn e2e
git commit -am "chore: phase-1 scaffolding complete #CI"
git push -u origin develop
gh pr create --base develop --fill
./scripts/slack-notify.sh "PR READY develop"
slack-notify DONE finalize
# =====================================================================
```
