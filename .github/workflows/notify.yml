# .github/workflows/notify.yml
name: Slack Notify for Commits & PR

on:
  push:
    branches: ["**"] # ã™ã¹ã¦ã®ãƒ–ãƒ©ãƒ³ãƒ
  pull_request:
    types: [opened, reopened, ready_for_review]

jobs:
  notify-slack:
    runs-on: ubuntu-latest

    env: # Secrets ã‚’ç’°å¢ƒå¤‰æ•°ã¸
      SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
      SLACK_CHANNEL_ID: ${{ secrets.SLACK_CHANNEL_ID }}

    steps:
      # jq ãŒä¸è¦ãªæ§‹æˆã«ã—ãŸã®ã§ install ã‚¹ãƒ†ãƒƒãƒ—ã¯çœç•¥ OK

      - name: Compose Slack message
        id: compose
        run: |
          if [ "${{ github.event_name }}" = "push" ]; then
            MSG="ğŸ“¦ *Commit pushed* by ${{ github.actor }} -> <${{ github.event.compare }}|diff>"
          else
            MSG="ğŸ” *PR created* <${{ github.event.pull_request.html_url }}|${{ github.event.pull_request.title }}> by ${{ github.actor }}"
          fi
          echo "SLACK_MESSAGE=$MSG" >> "$GITHUB_ENV"   # å¾Œæ®µã§å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

      - name: Post to Slack
        uses: slackapi/slack-github-action@v1
        with:
          channel-id: ${{ env.SLACK_CHANNEL_ID }} # å…¬å¼å¼•æ•°
          payload: |
            {
              "text": "${{ env.SLACK_MESSAGE }}"
            }
        env:
          SLACK_BOT_TOKEN: ${{ env.SLACK_BOT_TOKEN }}
